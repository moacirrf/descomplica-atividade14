<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Atvidade 14</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        header {
            height: 100px;
        }
    </style>
    <script>
        class FormController {
            constructor() {
                this.inputNome = document.getElementById("nome");
                this.alert = document.getElementById("alert");

            }


            search(button) {
                if (this.inputNome.validity.valid) {
                    this.inputNome.classList.remove("is-invalid");
                    this._getData(this.inputNome.value)
                    this.closeMessage();
                } else {
                    this.showMessage("Nome é obrgatório!");
                    this.inputNome.classList.add("is-invalid");
                }
            }

            showMessage(message) {
                document.getElementById("message").textContent = message;
                this.alert.classList.remove("invisible");
                this.alert.classList.add("visible");
            }

            closeMessage() {
                document.getElementById("message").textContent = "";
                this.alert.classList.add("invisible");
                this.alert.classList.remove("visible");
            }

            _getData(nome) {
                fetch(`https://servicodados.ibge.gov.br/api/v2/censos/nomes/${nome}`)
                    .then(response => response.json())
                    .then(json => {
                        if (json !== undefined && json.length > 0) {
                            return json[0];
                        } else {
                            throw new Error("Nenhum registro encontrado.");
                        }
                    })
                    .then(object => {
                        this.closeMessage();
                        this._fillTable(object);
                        console.log(object)
                    }).catch(error => {
                        this.showMessage(error.message);
                    });

            }

            _fillTable(resultado) {
                function createTd(text) {
                    const td = document.createElement('TD');
                    if (!text) {
                        text = "Sem dados";
                    }
                    if (typeof (text) === Array) {

                    } else {
                        td.textContent = text;
                    }
                    return td;
                }
                function createUl(periodo) {
                    const ul = document.createElement("UL");
                    console.log(periodo);
                    // periodo.each(item => {
                    //     console.log(item);
                    // });
                }
                const tr = document.createElement("TR");
                tr.append(createTd(resultado.nome));
                tr.append(createTd(resultado.sexo));
                tr.append(createTd(resultado.localidade));
                const tdPeriodo = createTd("");
                tdPeriodo.append(createUl(resultado.res));
                tr.append(tdPeriodo);
                document.getElementById("tbodyTable").append(tr);

            }
        }
        let controller;
        function inicializar() {
            controller = new FormController();
        }
    </script>
</head>

<body onload="inicializar()" class="bg-light">

    <header class="p-5 text-center text-primary-emphasis ">
        <h2>Saiba quais foram os nomes de pessoas mais utilizados no Brasil</h2>
        <p id="header-text"></p>
    </header>

    <main class="container">

        <div class="align-content-center">

            <div id="alert" class="text-center alert alert-danger alert-dismissible fade show invisible ">
                <span id="message">Errorr</span>
                <button type="submit" class=" align-content-to  btn-close" onclick="controller.closeMessage()"
                    aria-label="Close"></button>
            </div>

            <form id="form" class=" border p-5 mb-2 needs-validation" novalidate>
                <div class="form-group">
                    <label for="nome" class="form-label ">Nome</label>
                    <input id="nome" class="form-control " required />

                    <small id="nomeHelp" class="form-text text-muted">Informe apenas um nome de pessoa.</small>
                </div>
                <button id="pesquisar" onclick="controller.search(this)" type="submit"
                    class="btn btn-primary">Pesquisar</button>

            </form>



            <table class="table table-hover table-light border ">
                <thead>
                    <tr>
                        <th scope="col">Nome</th>
                        <th scope="col">Sexo</th>
                        <th scope="col">Localidade</th>
                        <th scope="col">Período</th>
                    </tr>
                </thead>
                <tbody id="tbodyTable">

                </tbody>
            </table>

        </div>
    </main>

    <footer class="text-center ">
        <p id="footer-text"></p>
        Moacir da Roza Flores <i class="bi bi-c-circle"></i> 2024-Engenharia da Computação-Descomplica
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</body>

</html>